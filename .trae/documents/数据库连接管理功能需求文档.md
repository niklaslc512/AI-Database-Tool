# ğŸ—„ï¸ æ•°æ®åº“è¿æ¥ç®¡ç†åŠŸèƒ½ - äº§å“éœ€æ±‚æ–‡æ¡£

## 1. äº§å“æ¦‚è¿°

æ•°æ®åº“è¿æ¥ç®¡ç†åŠŸèƒ½æ˜¯AIè¯­ä¹‰åŒ–æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼Œä¸ºå¼€å‘è€…è§’è‰²æä¾›å¤šç§æ•°æ®åº“ç±»å‹çš„è¿æ¥é…ç½®å’Œç®¡ç†èƒ½åŠ›ã€‚è¯¥åŠŸèƒ½æ”¯æŒPostgreSQLå’ŒMongoDBä¸¤ç§ä¸»æµæ•°æ®åº“ï¼Œæä¾›å®‰å…¨çš„è¿æ¥é…ç½®å­˜å‚¨ã€è¿æ¥æµ‹è¯•éªŒè¯å’Œè¿æ¥çŠ¶æ€ç›‘æ§åŠŸèƒ½ã€‚

æœ¬åŠŸèƒ½ä¸“ä¸ºå¼€å‘è€…è§’è‰²è®¾è®¡ï¼Œé€šè¿‡ç›´è§‚çš„Webç•Œé¢è¿›è¡Œæ•°æ®åº“è¿æ¥çš„åˆ›å»ºã€ç¼–è¾‘ã€æµ‹è¯•å’Œåˆ é™¤æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿå®‰å…¨å¯é åœ°è®¿é—®å„ç§æ•°æ®æºã€‚

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 ç”¨æˆ·è§’è‰²

| è§’è‰² | è®¿é—®æƒé™ | æ ¸å¿ƒåŠŸèƒ½ |
|------|----------|----------|
| å¼€å‘è€… (Developer) | æ•°æ®åº“è¿æ¥ç®¡ç†æƒé™ | åˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤è‡ªå·±çš„æ•°æ®åº“è¿æ¥ |
| ç®¡ç†å‘˜ (Admin) | å…¨å±€æ•°æ®åº“è¿æ¥ç®¡ç†æƒé™ | æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„æ•°æ®åº“è¿æ¥ï¼Œæ‰§è¡Œç®¡ç†æ“ä½œ |

### 2.2 åŠŸèƒ½æ¨¡å—

æœ¬æ•°æ®åº“è¿æ¥ç®¡ç†åŠŸèƒ½åŒ…å«ä»¥ä¸‹æ ¸å¿ƒé¡µé¢ï¼š

1. **æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢**: å±•ç¤ºæ•°æ®åº“è¿æ¥åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢ç­›é€‰å’Œæ‰¹é‡æ“ä½œ
2. **æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢**: åˆ›å»ºæ–°çš„æ•°æ®åº“è¿æ¥ï¼Œé…ç½®è¿æ¥å‚æ•°
3. **æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢**: æŸ¥çœ‹æ•°æ®åº“è¿æ¥è¯¦ç»†ä¿¡æ¯å’ŒçŠ¶æ€ç›‘æ§
4. **æ•°æ®åº“è¿æ¥ç¼–è¾‘é¡µé¢**: ä¿®æ”¹æ•°æ®åº“è¿æ¥é…ç½®å’Œå‚æ•°

### 2.3 é¡µé¢è¯¦æƒ…

| é¡µé¢åç§° | æ¨¡å—åç§° | åŠŸèƒ½æè¿° |
|----------|----------|----------|
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | åˆ—è¡¨å±•ç¤ºæ¨¡å— | å±•ç¤ºæ•°æ®åº“è¿æ¥åˆ—è¡¨ï¼ŒåŒ…å«åç§°ã€ç±»å‹ã€çŠ¶æ€ã€ä¸»æœºåœ°å€ã€åˆ›å»ºæ—¶é—´ã€æœ€åè¿æ¥æ—¶é—´ç­‰ä¿¡æ¯ |
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | æœç´¢ç­›é€‰æ¨¡å— | æ”¯æŒæŒ‰åç§°ã€æ•°æ®åº“ç±»å‹ã€è¿æ¥çŠ¶æ€è¿›è¡Œæœç´¢å’Œç­›é€‰ |
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | æ‰¹é‡æ“ä½œæ¨¡å— | æ”¯æŒæ‰¹é‡æµ‹è¯•è¿æ¥ã€å¯ç”¨ã€ç¦ç”¨ã€åˆ é™¤æ•°æ®åº“è¿æ¥æ“ä½œ |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | åŸºæœ¬ä¿¡æ¯é…ç½® | è®¾ç½®æ•°æ®åº“è¿æ¥åç§°ã€æè¿°ä¿¡æ¯ |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | æ•°æ®åº“ç±»å‹é€‰æ‹© | é€‰æ‹©æ•°æ®åº“ç±»å‹ï¼ˆPostgreSQLã€MongoDBï¼‰ï¼ŒåŠ¨æ€æ˜¾ç¤ºå¯¹åº”é…ç½®é¡¹ |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | è¿æ¥å‚æ•°é…ç½® | é…ç½®DSNè¿æ¥å­—ç¬¦ä¸²ï¼Œæ”¯æŒPostgreSQLå’ŒMongoDBæ ¼å¼ |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | é«˜çº§é…ç½®æ¨¡å— | è®¾ç½®è¿æ¥æ± å¤§å°ã€è¶…æ—¶æ—¶é—´ç­‰é«˜çº§å‚æ•° |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | è¿æ¥æµ‹è¯•æ¨¡å— | å®æ—¶æµ‹è¯•æ•°æ®åº“è¿æ¥æœ‰æ•ˆæ€§ï¼ŒéªŒè¯é…ç½®æ­£ç¡®æ€§ |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | åŸºæœ¬ä¿¡æ¯å±•ç¤º | æ˜¾ç¤ºæ•°æ®åº“è¿æ¥çš„æ‰€æœ‰é…ç½®ä¿¡æ¯å’Œå½“å‰çŠ¶æ€ |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | è¿æ¥çŠ¶æ€ç›‘æ§ | å±•ç¤ºè¿æ¥çŠ¶æ€ã€å“åº”æ—¶é—´ã€è¿æ¥æ± ä½¿ç”¨æƒ…å†µç­‰ç›‘æ§ä¿¡æ¯ |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | ä½¿ç”¨ç»Ÿè®¡æ¨¡å— | æ˜¾ç¤ºè¿æ¥ä½¿ç”¨æ¬¡æ•°ã€æŸ¥è¯¢ç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡ç­‰ |
| æ•°æ®åº“è¿æ¥ç¼–è¾‘é¡µé¢ | é…ç½®ä¿®æ”¹æ¨¡å— | ä¿®æ”¹æ•°æ®åº“è¿æ¥çš„å„é¡¹é…ç½®å‚æ•° |
| æ•°æ®åº“è¿æ¥ç¼–è¾‘é¡µé¢ | çŠ¶æ€ç®¡ç†æ¨¡å— | å¯ç”¨ã€ç¦ç”¨ã€é‡æ–°æµ‹è¯•æ•°æ®åº“è¿æ¥ |

## 3. æ ¸å¿ƒæµç¨‹

### å¼€å‘è€…æ“ä½œæµç¨‹

å¼€å‘è€…ç™»å½•ç³»ç»Ÿåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æµç¨‹ç®¡ç†æ•°æ®åº“è¿æ¥ï¼š

1. **è®¿é—®æ•°æ®åº“è¿æ¥ç®¡ç†é¡µé¢** â†’ æŸ¥çœ‹ç°æœ‰æ•°æ®åº“è¿æ¥åˆ—è¡¨
2. **åˆ›å»ºæ–°æ•°æ®åº“è¿æ¥** â†’ é€‰æ‹©æ•°æ®åº“ç±»å‹ â†’ é…ç½®DSNè¿æ¥å­—ç¬¦ä¸² â†’ æµ‹è¯•è¿æ¥ â†’ ä¿å­˜é…ç½®
3. **æŸ¥çœ‹æ•°æ®åº“è¿æ¥è¯¦æƒ…** â†’ è·å–è¿æ¥çŠ¶æ€å’Œä½¿ç”¨ç»Ÿè®¡
4. **ç¼–è¾‘æ•°æ®åº“è¿æ¥é…ç½®** â†’ ä¿®æ”¹è¿æ¥å‚æ•° â†’ é‡æ–°æµ‹è¯•è¿æ¥
5. **ç®¡ç†æ•°æ®åº“è¿æ¥çŠ¶æ€** â†’ å¯ç”¨ã€ç¦ç”¨æˆ–åˆ é™¤è¿æ¥

### ç®¡ç†å‘˜æ“ä½œæµç¨‹

ç®¡ç†å‘˜é™¤äº†æ‹¥æœ‰å¼€å‘è€…çš„æ‰€æœ‰æƒé™å¤–ï¼Œè¿˜å¯ä»¥ï¼š

1. **æŸ¥çœ‹å…¨å±€æ•°æ®åº“è¿æ¥** â†’ ç›‘æ§æ‰€æœ‰ç”¨æˆ·çš„æ•°æ®åº“è¿æ¥çŠ¶æ€
2. **æ‰§è¡Œç³»ç»Ÿç»´æŠ¤** â†’ æ£€æŸ¥è¿æ¥å¥åº·çŠ¶å†µå’Œæ€§èƒ½é—®é¢˜
3. **æ‰¹é‡ç®¡ç†æ“ä½œ** â†’ å¯¹å¤šä¸ªæ•°æ®åº“è¿æ¥æ‰§è¡Œæ‰¹é‡æ“ä½œ

```mermaid
graph TD
  A[å¼€å‘è€…ç™»å½•] --> B[æ•°æ®åº“è¿æ¥ç®¡ç†é¡µé¢]
  B --> C[æŸ¥çœ‹è¿æ¥åˆ—è¡¨]
  B --> D[åˆ›å»ºæ–°è¿æ¥]
  B --> E[ç¼–è¾‘ç°æœ‰è¿æ¥]
  B --> F[æŸ¥çœ‹è¿æ¥è¯¦æƒ…]
  
  D --> G[é€‰æ‹©æ•°æ®åº“ç±»å‹]
  G --> H[é…ç½®åŸºæœ¬ä¿¡æ¯]
  H --> I[è®¾ç½®DSNè¿æ¥å­—ç¬¦ä¸²]
  I --> J[é…ç½®é«˜çº§é€‰é¡¹]
  J --> K[æµ‹è¯•è¿æ¥]
  K --> L{è¿æ¥æˆåŠŸ?}
  L -->|æ˜¯| M[ä¿å­˜é…ç½®]
  L -->|å¦| N[ä¿®æ”¹å‚æ•°]
  N --> K
  
  E --> O[ä¿®æ”¹é…ç½®]
  O --> P[é‡æ–°æµ‹è¯•]
  P --> Q[ä¿å­˜æ›´æ”¹]
  
  F --> R[æŸ¥çœ‹çŠ¶æ€ç›‘æ§]
  F --> S[æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡]
```

## 4. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 4.1 è®¾è®¡é£æ ¼

éµå¾ªç³»ç»ŸUIè®¾è®¡æ ‡å‡†ï¼Œé‡‡ç”¨ä»¥ä¸‹è®¾è®¡å…ƒç´ ï¼š

- **ä¸»è‰²è°ƒ**: ç»¿è‰²ç³» (#10b981) ä½œä¸ºä¸»è¦æ“ä½œæŒ‰é’®å’Œè¿æ¥æˆåŠŸçŠ¶æ€æŒ‡ç¤º
- **è¾…åŠ©è‰²**: ç™½è‰²èƒŒæ™¯ (#ffffff)ã€æ·±ç°æ–‡æœ¬ (#1f2937)ã€æµ…ç°è¾¹æ¡† (#e2e8f0)
- **çŠ¶æ€è‰²**: ç»¿è‰²(è¿æ¥æˆåŠŸ)ã€çº¢è‰²(è¿æ¥å¤±è´¥)ã€æ©™è‰²(è¿æ¥ä¸­)ã€ç°è‰²(æœªè¿æ¥)
- **æŒ‰é’®é£æ ¼**: åœ†è§’è®¾è®¡ï¼Œå¸¦æœ‰è¾¹æ¡†å’Œé˜´å½±æ•ˆæœï¼Œæ‚¬åœæ—¶æœ‰è¿‡æ¸¡åŠ¨ç”»
- **å­—ä½“**: ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼Œæ ‡é¢˜ä½¿ç”¨ç²—ä½“ï¼Œæ­£æ–‡ä½¿ç”¨å¸¸è§„å­—é‡
- **å¸ƒå±€é£æ ¼**: å¡ç‰‡å¼å¸ƒå±€ï¼Œæ¸…æ™°çš„å±‚æ¬¡ç»“æ„ï¼Œå“åº”å¼è®¾è®¡
- **å›¾æ ‡é£æ ¼**: ä½¿ç”¨Lucideå›¾æ ‡åº“ï¼Œçº¿æ€§é£æ ¼ï¼Œæ•°æ®åº“ç±»å‹ä½¿ç”¨ä¸“ç”¨å›¾æ ‡

### 4.2 é¡µé¢è®¾è®¡æ¦‚è§ˆ

| é¡µé¢åç§° | æ¨¡å—åç§° | UIå…ƒç´  |
|----------|----------|--------|
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | é¡µé¢å¤´éƒ¨ | ç»¿è‰²æ¸å˜èƒŒæ™¯å¡ç‰‡ï¼ŒåŒ…å«é¡µé¢æ ‡é¢˜ã€æè¿°å’Œ"åˆ›å»ºæ•°æ®åº“è¿æ¥"æŒ‰é’®ï¼Œä½¿ç”¨ç»¿è‰²ä¸»è‰²è°ƒ |
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | æœç´¢ç­›é€‰åŒºåŸŸ | ç™½è‰²å¡ç‰‡å®¹å™¨ï¼ŒåŒ…å«æœç´¢è¾“å…¥æ¡†ã€æ•°æ®åº“ç±»å‹ç­›é€‰ã€çŠ¶æ€ç­›é€‰ï¼Œç»¿è‰²è¾¹æ¡†èšç„¦æ•ˆæœ |
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | è¿æ¥å¡ç‰‡åˆ—è¡¨ | ç½‘æ ¼å¸ƒå±€çš„è¿æ¥å¡ç‰‡ï¼Œæ¯ä¸ªå¡ç‰‡æ˜¾ç¤ºæ•°æ®åº“å›¾æ ‡ã€åç§°ã€ç±»å‹ã€çŠ¶æ€æŒ‡ç¤ºå™¨ |
| æ•°æ®åº“è¿æ¥åˆ—è¡¨é¡µé¢ | çŠ¶æ€æŒ‡ç¤ºå™¨ | åœ†å½¢çŠ¶æ€ç‚¹ï¼Œç»¿è‰²(åœ¨çº¿)ã€çº¢è‰²(ç¦»çº¿)ã€æ©™è‰²(è¿æ¥ä¸­)ã€ç°è‰²(æœªçŸ¥) |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | ç±»å‹é€‰æ‹©å¡ç‰‡ | å¤§å°ºå¯¸é€‰æ‹©å¡ç‰‡ï¼ŒPostgreSQLå’ŒMongoDBå›¾æ ‡ï¼Œé€‰ä¸­æ—¶ç»¿è‰²è¾¹æ¡†é«˜äº® |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | é…ç½®è¡¨å• | åˆ†ç»„çš„è¡¨å•å­—æ®µï¼ŒåŸºæœ¬é…ç½®ã€DSNè¿æ¥å­—ç¬¦ä¸²ã€é«˜çº§è®¾ç½®ä¸‰ä¸ªæŠ˜å é¢æ¿ |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | è¿æ¥æµ‹è¯•åŒºåŸŸ | ç‹¬ç«‹çš„æµ‹è¯•å¡ç‰‡ï¼ŒåŒ…å«æµ‹è¯•æŒ‰é’®ã€ç»“æœæ˜¾ç¤ºã€è¿æ¥æ—¶é—´æŒ‡ç¤º |
| æ•°æ®åº“è¿æ¥åˆ›å»ºé¡µé¢ | DSNé¢„è§ˆ | åªè¯»æ–‡æœ¬æ¡†æ˜¾ç¤ºç”Ÿæˆçš„è¿æ¥å­—ç¬¦ä¸²ï¼Œæ”¯æŒå¤åˆ¶åŠŸèƒ½ |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | ä¿¡æ¯æ¦‚è§ˆå¡ç‰‡ | ç½‘æ ¼å¸ƒå±€æ˜¾ç¤ºè¿æ¥åŸºæœ¬ä¿¡æ¯ï¼ŒçŠ¶æ€ä½¿ç”¨å¯¹åº”é¢œè‰²çš„å¾½ç« æ˜¾ç¤º |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | ç›‘æ§å›¾è¡¨ | å“åº”æ—¶é—´è¶‹åŠ¿å›¾ã€è¿æ¥æ± ä½¿ç”¨ç‡å›¾è¡¨ï¼Œä½¿ç”¨ç»¿è‰²ä¸»é¢˜é…è‰² |
| æ•°æ®åº“è¿æ¥è¯¦æƒ…é¡µé¢ | æ“ä½œæŒ‰é’®ç»„ | æµ‹è¯•è¿æ¥(ç»¿è‰²)ã€ç¼–è¾‘(è“è‰²)ã€ç¦ç”¨(æ©™è‰²)ã€åˆ é™¤(çº¢è‰²)æŒ‰é’® |
| æ•°æ®åº“è¿æ¥ç¼–è¾‘é¡µé¢ | ç¼–è¾‘è¡¨å• | ä¸åˆ›å»ºé¡µé¢ç›¸ä¼¼çš„è¡¨å•è®¾è®¡ï¼Œé¢„å¡«å……ç°æœ‰æ•°æ®ï¼Œä¿å­˜æŒ‰é’®ä½¿ç”¨ç»¿è‰²ä¸»è‰²è°ƒ |

### 4.3 å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯ä¼˜å…ˆ**: ä¸»è¦é’ˆå¯¹å¼€å‘è€…çš„æ¡Œé¢å·¥ä½œç¯å¢ƒè®¾è®¡
- **ç§»åŠ¨ç«¯é€‚é…**: è¿æ¥å¡ç‰‡åœ¨ç§»åŠ¨ç«¯å †å æ˜¾ç¤ºï¼Œè¡¨å•å­—æ®µå‚ç›´æ’åˆ—
- **è§¦æ‘¸ä¼˜åŒ–**: æŒ‰é’®å’Œäº¤äº’å…ƒç´ æ»¡è¶³æœ€å°44pxçš„è§¦æ‘¸ç›®æ ‡è¦æ±‚
- **æ¨ªå±é€‚é…**: æ”¯æŒå¹³æ¿è®¾å¤‡çš„æ¨ªå±æ˜¾ç¤ºæ¨¡å¼

## 5. æ•°æ®æ¨¡å‹è®¾è®¡

### 5.1 æ•°æ®åº“è¿æ¥æ•°æ®ç»“æ„

```typescript
// æ•°æ®åº“ç±»å‹æšä¸¾
type DatabaseType = 'postgresql' | 'mongodb';

// æ•°æ®åº“è¿æ¥æ¥å£
interface DatabaseConnection {
  id: string;                    // ğŸ†” è¿æ¥å”¯ä¸€æ ‡è¯†ç¬¦
  name: string;                  // ğŸ“ è¿æ¥åç§°
  type: DatabaseType;            // ğŸ—„ï¸ æ•°æ®åº“ç±»å‹
  dsn: string;                   // ğŸ”— æ•°æ®æºåç§°ï¼ˆè¿æ¥å­—ç¬¦ä¸²ï¼‰
  userId: string;                // ğŸ‘¤ æ‰€å±ç”¨æˆ·ID
  status: 'active' | 'inactive' | 'error'; // ğŸ“Š è¿æ¥çŠ¶æ€
  createdAt: Date;              // ğŸ“… åˆ›å»ºæ—¶é—´
  updatedAt: Date;              // ğŸ”„ æ›´æ–°æ—¶é—´
  lastConnectedAt?: Date;       // â° æœ€åè¿æ¥æ—¶é—´
  description?: string;          // ğŸ“„ æè¿°ä¿¡æ¯
}

// åˆ›å»ºæ•°æ®åº“è¿æ¥è¯·æ±‚
interface CreateDatabaseConnectionRequest {
  name: string;
  description?: string;
  type: DatabaseType;
  dsn: string;                   // æ•°æ®æºåç§°ï¼ˆè¿æ¥å­—ç¬¦ä¸²ï¼‰
  connectionTimeout?: number;
  maxConnections?: number;
}

// æ•°æ®åº“è¿æ¥æµ‹è¯•ç»“æœ
interface ConnectionTestResult {
  success: boolean;
  message: string;
  responseTime?: number;        // å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  serverVersion?: string;       // æœåŠ¡å™¨ç‰ˆæœ¬
  timestamp: Date;
}

// æ•°æ®åº“è¿æ¥ç»Ÿè®¡
interface DatabaseConnectionStats {
  totalConnections: number;
  successfulConnections: number;
  failedConnections: number;
  averageResponseTime: number;
  lastConnectionTime?: Date;
  uptime: number;               // å¯ç”¨æ—¶é—´ç™¾åˆ†æ¯”
}

// PostgreSQLç‰¹å®šé…ç½®
interface PostgreSQLConfig {
  schema?: string;              // é»˜è®¤æ¨¡å¼
  applicationName?: string;     // åº”ç”¨ç¨‹åºåç§°
  searchPath?: string[];        // æœç´¢è·¯å¾„
}

// MongoDBç‰¹å®šé…ç½®
interface MongoDBConfig {
  authSource?: string;          // è®¤è¯æ•°æ®åº“
  replicaSet?: string;          // å‰¯æœ¬é›†åç§°
  readPreference?: string;      // è¯»åå¥½
}
```

### 5.2 æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- æ•°æ®åº“è¿æ¥è¡¨
CREATE TABLE database_connections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  type VARCHAR(20) NOT NULL CHECK (type IN ('postgresql', 'mongodb')),
  dsn TEXT NOT NULL, -- æ•°æ®æºåç§°ï¼ˆè¿æ¥å­—ç¬¦ä¸²ï¼‰
  user_id UUID NOT NULL REFERENCES users(id),
  status VARCHAR(20) DEFAULT 'inactive' CHECK (status IN ('active', 'inactive', 'error')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_connected_at TIMESTAMP WITH TIME ZONE,
  description TEXT
);

-- ç´¢å¼•
CREATE INDEX idx_database_connections_user_id ON database_connections(user_id);
CREATE INDEX idx_database_connections_type ON database_connections(type);
CREATE INDEX idx_database_connections_is_active ON database_connections(is_active);
CREATE INDEX idx_database_connections_last_connected ON database_connections(last_connected_at DESC);

-- æ•°æ®åº“è¿æ¥æµ‹è¯•æ—¥å¿—è¡¨
CREATE TABLE connection_test_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  connection_id UUID NOT NULL REFERENCES database_connections(id) ON DELETE CASCADE,
  success BOOLEAN NOT NULL,
  message TEXT,
  response_time INTEGER, -- æ¯«ç§’
  server_version VARCHAR(50),
  error_code VARCHAR(20),
  tested_by UUID REFERENCES users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æµ‹è¯•æ—¥å¿—ç´¢å¼•
CREATE INDEX idx_connection_test_logs_connection_id ON connection_test_logs(connection_id);
CREATE INDEX idx_connection_test_logs_created_at ON connection_test_logs(created_at DESC);
CREATE INDEX idx_connection_test_logs_success ON connection_test_logs(success);

-- æ•°æ®åº“è¿æ¥ä½¿ç”¨ç»Ÿè®¡è¡¨
CREATE TABLE connection_usage_stats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  connection_id UUID NOT NULL REFERENCES database_connections(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  connection_count INTEGER NOT NULL DEFAULT 0,
  query_count INTEGER NOT NULL DEFAULT 0,
  total_response_time INTEGER NOT NULL DEFAULT 0, -- æ¯«ç§’
  error_count INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  -- ç¡®ä¿æ¯ä¸ªè¿æ¥æ¯å¤©åªæœ‰ä¸€æ¡è®°å½•
  UNIQUE(connection_id, date)
);

-- ä½¿ç”¨ç»Ÿè®¡ç´¢å¼•
CREATE INDEX idx_connection_usage_stats_connection_id ON connection_usage_stats(connection_id);
CREATE INDEX idx_connection_usage_stats_date ON connection_usage_stats(date DESC);
```

## 6. APIæ¥å£è®¾è®¡

### 6.1 RESTful APIç«¯ç‚¹

```typescript
// è·å–æ•°æ®åº“è¿æ¥åˆ—è¡¨
GET /api/v1/database-connections
Query Parameters:
- page: number (é¡µç )
- limit: number (æ¯é¡µæ•°é‡)
- search: string (æœç´¢å…³é”®è¯)
- type: 'postgresql' | 'mongodb' (æ•°æ®åº“ç±»å‹ç­›é€‰)
- status: 'active' | 'inactive' (çŠ¶æ€ç­›é€‰)

// åˆ›å»ºæ•°æ®åº“è¿æ¥
POST /api/v1/database-connections
Body: CreateDatabaseConnectionRequest

// è·å–æ•°æ®åº“è¿æ¥è¯¦æƒ…
GET /api/v1/database-connections/:id

// æ›´æ–°æ•°æ®åº“è¿æ¥
PUT /api/v1/database-connections/:id
Body: Partial<CreateDatabaseConnectionRequest>

// åˆ é™¤æ•°æ®åº“è¿æ¥
DELETE /api/v1/database-connections/:id

// å¯ç”¨/ç¦ç”¨æ•°æ®åº“è¿æ¥
PATCH /api/v1/database-connections/:id/status
Body: { isActive: boolean }

// æµ‹è¯•æ•°æ®åº“è¿æ¥
POST /api/v1/database-connections/:id/test

// æµ‹è¯•æ–°çš„è¿æ¥é…ç½®ï¼ˆåˆ›å»ºå‰æµ‹è¯•ï¼‰
POST /api/v1/database-connections/test
Body: CreateDatabaseConnectionRequest

// è·å–æ•°æ®åº“è¿æ¥ç»Ÿè®¡
GET /api/v1/database-connections/:id/stats
Query Parameters:
- period: 'day' | 'week' | 'month' (ç»Ÿè®¡å‘¨æœŸ)

// è·å–æ•°æ®åº“è¿æ¥æµ‹è¯•æ—¥å¿—
GET /api/v1/database-connections/:id/test-logs
Query Parameters:
- page: number
- limit: number
- startDate: string (ISOæ—¥æœŸ)
- endDate: string (ISOæ—¥æœŸ)

// è·å–æ•°æ®åº“è¿æ¥çš„è¡¨ç»“æ„ä¿¡æ¯
GET /api/v1/database-connections/:id/schema

// æ‰¹é‡æµ‹è¯•è¿æ¥
POST /api/v1/database-connections/batch-test
Body: { connectionIds: string[] }
```

### 6.2 å“åº”æ ¼å¼ç¤ºä¾‹

```json
// æˆåŠŸå“åº” - æ•°æ®åº“è¿æ¥åˆ—è¡¨
{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "ç”Ÿäº§ç¯å¢ƒPostgreSQL",
      "type": "postgresql",
      "dsn": "postgresql://app_user:password@prod-db.example.com:5432/main_db?sslmode=require",
      "userId": "user123",
      "status": "active",
      "createdAt": "2024-01-01T00:00:00Z",
      "updatedAt": "2024-01-15T10:30:00Z",
      "lastConnectedAt": "2024-01-15T10:30:00Z",
      "description": "ä¸»è¦ä¸šåŠ¡æ•°æ®åº“"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 15,
    "totalPages": 2
  }
}

// æˆåŠŸå“åº” - è¿æ¥æµ‹è¯•ç»“æœ
{
  "success": true,
  "message": "è¿æ¥æˆåŠŸ",
  "responseTime": 45,
  "serverVersion": "PostgreSQL 14.5",
  "timestamp": "2024-01-15T10:30:00Z"
}

// å¤±è´¥å“åº” - è¿æ¥æµ‹è¯•å¤±è´¥
{
  "success": false,
  "message": "è¿æ¥è¶…æ—¶",
  "responseTime": 30000,
  "timestamp": "2024-01-15T10:30:00Z",
  "errorCode": "TIMEOUT"
}

// æˆåŠŸå“åº” - è¿æ¥ç»Ÿè®¡
{
  "totalConnections": 1250,
  "successfulConnections": 1200,
  "failedConnections": 50,
  "averageResponseTime": 85,
  "lastConnectionTime": "2024-01-15T10:30:00Z",
  "uptime": 96.0,
  "dailyStats": [
    {
      "date": "2024-01-15",
      "connections": 150,
      "queries": 2500,
      "averageResponseTime": 80,
      "errors": 2
    }
  ]
}

// é”™è¯¯å“åº”
{
  "message": "æ•°æ®åº“è¿æ¥åç§°å·²å­˜åœ¨",
  "timestamp": "2024-01-15T10:30:00Z",
  "path": "/api/v1/database-connections"
}
```

## 7. å®‰å…¨è€ƒè™‘

### 7.1 DSNå®‰å…¨
- æ•°æ®åº“DSNè¿æ¥å­—ç¬¦ä¸²ä½¿ç”¨AES-256åŠ å¯†å­˜å‚¨
- åŠ å¯†å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†ï¼Œä¸å­˜å‚¨åœ¨ä»£ç ä¸­
- æ”¯æŒDSNè½®æ¢ï¼Œæä¾›è¿æ¥å­—ç¬¦ä¸²æ›´æ–°æ¥å£

### 7.2 è¿æ¥å®‰å…¨
- DSNè¿æ¥å­—ç¬¦ä¸²æ”¯æŒSSL/TLSåŠ å¯†è¿æ¥é…ç½®
- è¿æ¥è¶…æ—¶è®¾ç½®é˜²æ­¢é•¿æ—¶é—´å ç”¨èµ„æº
- è¿æ¥æ± é™åˆ¶é˜²æ­¢èµ„æºè€—å°½

### 7.3 æƒé™æ§åˆ¶
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- ç”¨æˆ·åªèƒ½ç®¡ç†è‡ªå·±åˆ›å»ºçš„æ•°æ®åº“è¿æ¥
- ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰è¿æ¥

### 7.4 å®¡è®¡æ—¥å¿—
- è®°å½•æ‰€æœ‰æ•°æ®åº“è¿æ¥æ“ä½œæ—¥å¿—
- è®°å½•è¿æ¥æµ‹è¯•ç»“æœå’Œå¤±è´¥åŸå› 
- æ”¯æŒè¿æ¥å¼‚å¸¸å‘Šè­¦

## 8. æŠ€æœ¯å®ç°è¦ç‚¹

### 8.1 å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3 + Composition API
- **æ ·å¼**: TailwindCSS 4 + DaisyUI 5
- **çŠ¶æ€ç®¡ç†**: Pinia
- **HTTPå®¢æˆ·ç«¯**: Axios
- **å›¾è¡¨**: ECharts (ç”¨äºç›‘æ§å›¾è¡¨)
- **è¡¨å•éªŒè¯**: VeeValidate

### 8.2 åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Express.js + TypeScript
- **æ•°æ®åº“**: PostgreSQL
- **æ•°æ®åº“é©±åŠ¨**: pg (PostgreSQL), mongodb (MongoDB)
- **åŠ å¯†**: crypto (Node.jså†…ç½®)
- **è¿æ¥æ± **: å„æ•°æ®åº“å¯¹åº”çš„è¿æ¥æ± å®ç°

### 8.3 å…³é”®å®ç°ç»†èŠ‚

#### è¿æ¥æ± ç®¡ç†
```typescript
// è¿æ¥æ± ç®¡ç†å™¨
class ConnectionPoolManager {
  private pools: Map<string, any> = new Map()
  
  async getConnection(connectionId: string): Promise<any> {
    if (!this.pools.has(connectionId)) {
      const config = await this.getConnectionConfig(connectionId)
      const pool = this.createPool(config)
      this.pools.set(connectionId, pool)
    }
    return this.pools.get(connectionId)
  }
  
  async testConnection(config: DatabaseConnectionConfig): Promise<ConnectionTestResult> {
    const startTime = Date.now()
    try {
      const connection = await this.createTestConnection(config)
      const responseTime = Date.now() - startTime
      await connection.close()
      
      return {
        success: true,
        message: 'è¿æ¥æˆåŠŸ',
        responseTime,
        timestamp: new Date()
      }
    } catch (error) {
      return {
        success: false,
        message: error.message,
        responseTime: Date.now() - startTime,
        timestamp: new Date()
      }
    }
  }
}
```

#### DSNè¿æ¥å­—ç¬¦ä¸²åŠ å¯†/è§£å¯†
```typescript
// DSNåŠ å¯†æœåŠ¡
class DSNEncryptionService {
  private readonly algorithm = 'aes-256-gcm'
  private readonly key = process.env.DB_DSN_ENCRYPTION_KEY
  
  encrypt(dsn: string): string {
    const iv = crypto.randomBytes(16)
    const cipher = crypto.createCipher(this.algorithm, this.key)
    cipher.setAAD(Buffer.from('database-dsn'))
    
    let encrypted = cipher.update(dsn, 'utf8', 'hex')
    encrypted += cipher.final('hex')
    
    const authTag = cipher.getAuthTag()
    return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`
  }
  
  decrypt(encryptedDSN: string): string {
    const [ivHex, authTagHex, encrypted] = encryptedDSN.split(':')
    const iv = Buffer.from(ivHex, 'hex')
    const authTag = Buffer.from(authTagHex, 'hex')
    
    const decipher = crypto.createDecipher(this.algorithm, this.key)
    decipher.setAAD(Buffer.from('database-dsn'))
    decipher.setAuthTag(authTag)
    
    let decrypted = decipher.update(encrypted, 'hex', 'utf8')
    decrypted += decipher.final('utf8')
    
    return decrypted
  }
}
```

#### æ•°æ®åº“é€‚é…å™¨æ¨¡å¼
```typescript
// æ•°æ®åº“é€‚é…å™¨æ¥å£
interface DatabaseAdapter {
  connect(config: DatabaseConnectionConfig): Promise<void>
  disconnect(): Promise<void>
  testConnection(): Promise<ConnectionTestResult>
  getSchema(): Promise<SchemaInfo>
  executeQuery(query: string): Promise<QueryResult>
}

// PostgreSQLé€‚é…å™¨
class PostgreSQLAdapter implements DatabaseAdapter {
  private pool: Pool
  
  async connect(config: DatabaseConnectionConfig): Promise<void> {
    this.pool = new Pool({
      connectionString: config.dsn,
      max: config.maxConnections || 10,
      connectionTimeoutMillis: (config.connectionTimeout || 30) * 1000
    })
  }
  
  async testConnection(): Promise<ConnectionTestResult> {
    const startTime = Date.now()
    try {
      const client = await this.pool.connect()
      const result = await client.query('SELECT version()')
      client.release()
      
      return {
        success: true,
        message: 'è¿æ¥æˆåŠŸ',
        responseTime: Date.now() - startTime,
        serverVersion: result.rows[0].version,
        timestamp: new Date()
      }
    } catch (error) {
      return {
        success: false,
        message: error.message,
        responseTime: Date.now() - startTime,
        timestamp: new Date()
      }
    }
  }
}

// MongoDBé€‚é…å™¨
class MongoDBAdapter implements DatabaseAdapter {
  private client: MongoClient
  
  async connect(config: DatabaseConnectionConfig): Promise<void> {
    this.client = new MongoClient(config.dsn, {
      maxPoolSize: config.maxConnections || 10,
      serverSelectionTimeoutMS: (config.connectionTimeout || 30) * 1000
    })
    await this.client.connect()
  }
  
  async testConnection(): Promise<ConnectionTestResult> {
    const startTime = Date.now()
    try {
      await this.client.db().admin().ping()
      const serverStatus = await this.client.db().admin().serverStatus()
      
      return {
        success: true,
        message: 'è¿æ¥æˆåŠŸ',
        responseTime: Date.now() - startTime,
        serverVersion: serverStatus.version,
        timestamp: new Date()
      }
    } catch (error) {
      return {
        success: false,
        message: error.message,
        responseTime: Date.now() - startTime,
        timestamp: new Date()
      }
    }
  }
}
```

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 è¿æ¥æ± ä¼˜åŒ–
- åˆç†è®¾ç½®è¿æ¥æ± å¤§å°ï¼Œé¿å…èµ„æºæµªè´¹
- å®ç°è¿æ¥æ± ç›‘æ§ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆ
- æ”¯æŒè¿æ¥æ± é¢„çƒ­ï¼Œå‡å°‘é¦–æ¬¡è¿æ¥å»¶è¿Ÿ

### 9.2 ç¼“å­˜ç­–ç•¥
- ç¼“å­˜æ•°æ®åº“è¿æ¥é…ç½®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- ç¼“å­˜è¿æ¥æµ‹è¯•ç»“æœï¼Œé¿å…é¢‘ç¹æµ‹è¯•
- å®ç°è¿æ¥çŠ¶æ€ç¼“å­˜ï¼Œæé«˜å“åº”é€Ÿåº¦
